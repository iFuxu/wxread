name: wxread

on:
  schedule:
    - cron: '0 21 * * *'  # åŒ—äº¬5:00å·¦å³å¼€å§‹
    - cron: '40 3 * * *'  # åŒ—äº¬11:40å·¦å³å¼€å§‹
    - cron: '00 14 * * *' # åŒ—äº¬21:30 - 22:00å·¦å³å¼€å§‹
    - cron: '0 9 * * sat' # å‘¨å…­éšæœºé˜…è¯»
    - cron: '0 9 * * sun' # å‘¨æ—¥éšæœºé˜…è¯»
  workflow_dispatch:
    inputs:
      mode:
        description: 'è¿è¡Œæ¨¡å¼ (auto/manual)'
        required: false
        default: 'auto'

env:
  DNS_SERVER_1: 8.8.8.8
  DNS_SERVER_2: 8.8.4.4
  PYTHON_VERSION: '3.10'  # å®šä¹‰ç¯å¢ƒå˜é‡
  CERTIFI_VERSION: 2024.8.30
  CHARSET_NORMALIZER_VERSION: 3.4.0
  IDNA_VERSION: 3.10
  REQUESTS_VERSION: 2.32.3
  URLLIB3_VERSION: 2.2.3
  BASE_MINUTES: $((3 * 60 + 30))
  FLOAT_MINUTES: 30
  WEEKEND_MIN: 90
  WEEKEND_MAX: 190

jobs:
  deploy:
    runs-on: ubuntu-22.04
    environment: AutoRead

    steps:
    - name: ğŸ”§ è®¾ç½®DNS
      run: |
        echo "nameserver $DNS_SERVER_1" | sudo tee /etc/resolv.conf
        echo "nameserver $DNS_SERVER_2" | sudo tee -a /etc/resolv.conf
        echo "âœ… DNSé…ç½®å®Œæˆ"

    - name: ğŸ“¥ æ£€å‡ºä»“åº“
      uses: actions/checkout@v4

    - name: ç¼“å­˜ä¾èµ–
      uses: actions/cache@v3
      with:
        path: ~/.cache/pip
        key: ${{ runner.os }}-pip-${{ hashFiles('requirements.txt') }}
        restore-keys: |
          ${{ runner.os }}-pip-

    - name: ğŸ è®¾ç½®Python $PYTHON_VERSION
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYTHON_VERSION }}  # ä¿®æ­£å¼•ç”¨æ–¹å¼
